<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Chapter&nbsp;2.&nbsp;Hands-on Tutorial</title><link rel="stylesheet" href="css/docbook-style.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.72.0"><link rel="start" href="user-guide.html" title="SymmetricDS 2 User Guide"><link rel="up" href="user-guide.html" title="SymmetricDS 2 User Guide"><link rel="prev" href="introduction.html" title="Chapter&nbsp;1.&nbsp;Introduction"><link rel="next" href="planning.html" title="Chapter&nbsp;3.&nbsp;Planning an Implementation"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div xmlns:fo="http://www.w3.org/1999/XSL/Format" id="banner"><a style="border:none;" href="http://www.symmetricds.org/" title="SymmetricDS User Guide"><img style="border:none;" alt="SymmetricDS" src="images/banner-logo.gif"></a></div><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="tutorial"></a>Chapter&nbsp;2.&nbsp;Hands-on Tutorial</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="section"><a href="tutorial.html#tutorial-install">2.1. Installing SymmetricDS</a></span></dt><dt><span class="section"><a href="tutorial.html#ch02-create-database">2.2. Creating and Populating Your Databases</a></span></dt><dt><span class="section"><a href="tutorial.html#ch02-start-server">2.3. Starting SymmetricDS</a></span></dt><dt><span class="section"><a href="tutorial.html#ch02-register-node">2.4. Registering a Node</a></span></dt><dt><span class="section"><a href="tutorial.html#ch02-initial-load">2.5. Sending an Initial Load</a></span></dt><dt><span class="section"><a href="tutorial.html#ch02-pull">2.6. Pulling Data</a></span></dt><dt><span class="section"><a href="tutorial.html#ch02-push">2.7. Pushing Data</a></span></dt><dt><span class="section"><a href="tutorial.html#ch02-verify-outgoing">2.8. Verifying Outgoing Batches</a></span></dt><dt><span class="section"><a href="tutorial.html#ch02-verify-incoming">2.9. Verifying Incoming Batches</a></span></dt></dl></div>
    
    <p>Now that several of the features of SymmetricDS have been discussed, a quick working example of SymmetricDS is in order. 
        This section contains a hands-on tutorial that demonstrates how to synchronize a sample database between two running
        instances of SymmetricDS. This example models a retail business that has a central office database (called "root") and
        multiple retail store databases (called "client").  For the tutorial, we will have only one "client", as shown in <a href="tutorial.html#figure-tutorial" title="Figure&nbsp;2.1.&nbsp;Simplified Two Tiered Retail Store Tutorial Example">Figure&nbsp;2.1</a>.
        </p>
        
        <p>
                </p><div class="figure"><a name="figure-tutorial"></a><div class="figure-contents">
                    
                    <div class="mediaobject"><img src="./images/tutorial-arch.gif" alt="Simplified Two Tiered Retail Store Tutorial Example"></div>
                </div><p class="title"><b>Figure&nbsp;2.1.&nbsp;Simplified Two Tiered Retail Store Tutorial Example</b></p></div><p><br class="figure-break">
            </p>     
         <p>
        
        The root SymmetricDS instance sends changes to the client for item data, such as
        item number, description, and price. The client SymmetricDS sends changes to the root for sale transaction data, such as time
        of sale and items sold. The sample configuration specifies synchronization with a pull method for the client to receive
        data from root, and a push method for the root to receive data from client.</p>
    <p>This tutorial will walk you through:
      </p><div class="procedure"><ol type="1"><li><p>Installing instances of SymmetricDS for the tutorial,</p></li><li><p>Creating separate databases for the root and client,</p></li><li><p>Creating sample tables for client and root and sample data for the root,</p></li><li><p>Starting SymmetricDS and registering the client with the root,</p></li><li><p>Sending an initial load to the client,</p></li><li><p>Causing a data push and data pull operation, and</p></li><li><p>Verifying information about the batches that were sent and received.</p></li></ol></div><p>
       </p>
    
     
     <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="tutorial-install"></a>2.1.&nbsp;Installing SymmetricDS</h2></div></div></div>
        
        <p> First, we will install the SymmetricDS software and configure it with your database connection information:</p>
        <div class="procedure"><ol type="1"><li>
                <p>
                    Download the
                    <a xmlns:xlink="http://www.w3.org/1999/xlink" href="https://sourceforge.net/projects/symmetricds/files/" target="_top">symmetric-ds-2.x.x-server.zip</a>
                    file from
                    <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.symmetricds.org/" target="_top">http://www.symmetricds.org/</a>
                </p>
            </li><li>
                <p>
                    Unzip the file in any directory you choose. This will create a
                    <code class="filename">symmetric-ds-2.x.x-server</code>
                    subdirectory, which corresponds to the version you downloaded.
                </p>
            </li><li>
                <p>Edit the database properties in the following property files for the root (central office) and client (store) nodes:</p>
                <p>
                    </p><div class="itemizedlist"><ul type="disc" compact><li>
                            <p>
                                <code class="filename">samples/root.properties</code>
                            </p>
                        </li><li>
                            <p>
                                <code class="filename">samples/client.properties</code>
                            </p>
                        </li></ul></div><p>
                </p>
            </li><li>
                <p>
                    Set the following properties in
                    <span class="emphasis"><em>both</em></span>
                    files to specify how to connect to the database:
                </p>
                <pre class="programlisting"># The class name for the JDBC Driver
db.driver=com.mysql.jdbc.Driver

# The JDBC URL used to connect to the database
db.url=jdbc:mysql://localhost/sample

# The user to login as who can create and update tables
db.user=symmetric

# The password for the user to login as
db.password=secret</pre>
            </li><li>
                <p>
                    Next, set the following property in the
                    <code class="filename">client.properties</code>
                    file to specify where the root node can be contacted:
                </p>
                <pre class="programlisting"># The HTTP URL of the root node to contact for registration
registration.url=http://localhost:8080/sync</pre>
                <p> For the tutorial, the client database starts out empty, and the node is not registered. Registration is the
                    process where the node receives its configuration and stores it in its database. The configuration describes
                    which database tables to synchronize and to which nodes. When an unregistered node starts up, it will
                    register with the node specified by the registration URL. The registration node centrally controls nodes on
                    the network by allowing registration and returning configuration. In this tutorial, the registration node is
                    the root node, which also participates in synchronization with other nodes.</p>
            </li></ol></div>
    </div>
    <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ch02-create-database"></a>2.2.&nbsp;Creating and Populating Your Databases</h2></div></div></div>
        
        <div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3>
            <p> You must first create the databases for your root and client nodes using the administration tools provided by
                your database vendor. Make sure the name of the databases you create match the settings in the properties files.
            </p>
            <p>
                See
                 <a href="databases.html" title="Appendix&nbsp;C.&nbsp;Database Notes">Appendix&nbsp;C, <i xmlns:xlink="http://www.w3.org/1999/xlink">Database Notes</i></a>,
                for compatibility with your specific database.
            </p>
        </div>
        <p>
            First, create the sample tables in the
            <span class="emphasis"><em>root</em></span>
            node database, load the sample data, and load the sample configuration.
        </p>
        <div class="procedure"><ol type="1"><li>
                <p>
                    Open a command prompt and navigate to the
                    <code class="filename">samples</code>
                    subdirectory of your SymmetricDS installation.
                </p>
            </li><li>
                <p>Create the sample tables in the root database by executing the following command:</p>
                <p>
                    <span><strong class="command">../bin/sym -p root.properties --run-ddl create_sample.xml</strong></span>
                </p>
                <p> Note that the warning messages from the command are safe to ignore.</p>
            </li><li>
                <p>Next, create the SymmetricDS tables in the root node database. These tables will contain the configuration for
                    synchronization. The following command uses the auto-creation feature to create all the necessary SymmetricDS
                    system tables.</p>
                <p>
                    <span><strong class="command">../bin/sym -p root.properties --auto-create</strong></span>
                </p>
            </li><li>
                <p>Finally, load the sample data and configuration into the root node database by executing:</p>
                <p>
                    <span><strong class="command">../bin/sym -p root.properties --run-sql insert_sample.sql</strong></span>
                </p>
            </li></ol></div>
        <p>
            We have now created the root database tables and populated them with sample data.  Next, we create the sample tables in the
            <span class="emphasis"><em>client</em></span>
            node database to prepare it for receiving data.
        </p>
        <div class="procedure"><ol type="1"><li>
                <p>
                    Open a command prompt and navigate to the
                    <code class="filename">samples</code>
                    subdirectory of your SymmetricDS installation.
                </p>
            </li><li>
                <p>Create the sample tables in the client database by executing:</p>
                <p>
                    <span><strong class="command"> ../bin/sym -p client.properties --run-ddl create_sample.xml</strong></span>
                </p>
                <p> Note that the warning messages from the command are safe to ignore.</p>
            </li></ol></div>
        <p>
            Please verify
            <span class="emphasis"><em>both</em></span>
            databases by logging in and listing the tables.
        </p>
        <div class="procedure"><ol type="1"><li>
                <p> Find the item tables that sync from root to client: item and item_selling_price.</p>
            </li><li>
                <p> Find the sales tables that sync from client to root: sale_transaction and sale_return_line_item.</p>
            </li><li>
                <p> Find the SymmetricDS system tables, which have a prefix of "sym_".</p>
            </li><li>
                <p>Validate the root item tables have sample data.</p>
            </li></ol></div>
    </div>
    <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ch02-start-server"></a>2.3.&nbsp;Starting SymmetricDS</h2></div></div></div>
        
        <p> Database setup and configuration for the tutorial is now complete.  Time to put SymmetricDS into action.
        We will now start both SymmetricDS nodes and observe the logging output.</p>
        <div class="procedure"><ol type="1"><li>
                <p>
                    Open a command prompt and navigate to the
                    <code class="filename">samples</code>
                    subdirectory of your SymmetricDS installation.
                </p>
            </li><li>
                <p>Start the root node server by executing:</p>
                <p>
                    <span><strong class="command">../bin/sym -p root.properties --port 8080 --server</strong></span>
                </p>
                <p> The root node server starts up and creates all the triggers that were configured by the sample
                    configuration. It listens on port 8080 for synchronization and registration requests.</p>
            </li><li>
                <p>Start the client node server by executing:</p>
                <p>
                    <span><strong class="command">../bin/sym -p client.properties --port 9090 --server</strong></span>
                </p>
                <p> The client node server starts up and uses the auto-creation feature to create the SymmetricDS system
                    tables. It begins polling the root node in order to register. Since registration is not yet open, the client
                    node receives an authorization failure (HTTP response of 403).</p>
            </li></ol></div>
        <div class="tip" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Tip</h3>
            
            <p> If you want to change the port number used by SymmetricDS, you need to also set the sync.url runtime property to
                match. The default value is:</p>
            <pre class="programlisting">sync.url=http://localhost:8080/sync</pre>
        </div>
    </div>
    <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ch02-register-node"></a>2.4.&nbsp;Registering a Node</h2></div></div></div>
        
        <p> Next, we need to open registration for the client node so that it may receive its initial load of
         data and so that it may receive and send data from and to the root node. 
         There are several ways to do this.  We will use the administration feature on the root node.</p>
        <div class="procedure"><ol type="1"><li>
                <p>
                    Open a command prompt and navigate to the
                    <code class="filename">samples</code>
                    subdirectory of your SymmetricDS installation.
                </p>
            </li><li>
                <p>Open registration for the client node server by executing:</p>
                <p>
                    <span><strong class="command"> ../bin/sym -p root.properties --open-registration "store,1"</strong></span>
                </p>
                <p>
                    The registration is now opened for a node group called "store" with an external identifier of "1". This
                    information matches the settings in
                    <code class="filename">client.properties</code>
                    for the client node. Each node is assigned to a node group and is given an external ID that makes sense for the
                    application. In this tutorial, we have retail stores that run SymmetricDS, so we named our node group "store" and
                    we used numeric identifiers starting with "1".  More information about node groups will be covered in the next chapter.
                </p>
            </li><li>
                <p> Watch the logging output of the client node to see it successfully register with the root node. The client
                    is configured to attempt registration once per minute. Once registered, the root and client are enabled for
                    synchronization!</p>
            </li></ol></div>
    </div>
    <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ch02-initial-load"></a>2.5.&nbsp;Sending an Initial Load</h2></div></div></div>
        
        <p>Next, we will send an initial load of data to our store (that is, the client node), again using the root node administration feature.</p>
        <div class="procedure"><ol type="1"><li>
                <p>
                    Open a command prompt and navigate to the
                    <code class="filename">samples</code>
                    subdirectory of your SymmetricDS installation.
                </p>
            </li><li>
                <p>Send an initial load of data to the client node server by executing:</p>
                <p>
                    <span><strong class="command">../bin/sym -p root.properties --reload-node 1</strong></span>
                </p>
                <p> With this command, the root node queues up an initial load for the client node that will be sent the next
                    time the client performs its pull. The initial load includes data for each table that is configured for
                    synchronization.</p>
            </li><li>
                <p> Watch the logging output of both nodes to see the data transfer. The client is configured to pull data from
                    the root every minute.</p>
            </li></ol></div>
    </div>
    <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ch02-pull"></a>2.6.&nbsp;Pulling Data</h2></div></div></div>
        
        <p>Next, we will make a change to the item data in the central office (we'll add a new item), and observe the data being pulled down to
        the store.
        </p>
        <div class="procedure"><ol type="1"><li>
                <p>Open an interactive SQL session with the <span class="emphasis"><em>root</em></span> database.</p>
            </li><li>
                <p>Add a new item for sale:</p>
                <p>
                    <span><strong class="command"> insert into item_selling_price (price_id, price) values (55, 0.65);</strong></span>
                </p>
                <p>
                    <span><strong class="command"> insert into item (item_id, price_id, name) values (110000055, 55, 'Soft Drink');</strong></span>
                </p>
                <p> Once the statements are committed, the data change is captured by SymmetricDS and queued for the client node to pull.
                </p>
            </li><li>
                <p> Watch the logging output of both nodes to see the data transfer. The client is configured to pull data from
                    the root every minute.</p>
            </li><li>
                <p> Verify that the new data arrives in the client database using another interactive SQL session.</p>
            </li></ol></div>
    </div>
    <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ch02-push"></a>2.7.&nbsp;Pushing Data</h2></div></div></div>
        
        <p>We will now simulate a sale at the store and observe how SymmetricDS pushes the sale transaction to the central office.</p>
        <div class="procedure"><ol type="1"><li>
                <p>Open an interactive SQL session with the <span class="emphasis"><em>client</em></span> database.</p>
            </li><li>
                <p>Add a new sale to the client database:</p>
                <p>
                    <span><strong class="command"> insert into sale_transaction (tran_id, store, workstation, day, seq) values (1000, '1', '3',
                        '2007-11-01', 100);</strong></span>
                </p>
                <p>
                    <span><strong class="command"> insert into sale_return_line_item (tran_id, item_id, price, quantity) values (1000, 110000055, 0.65,
                        1);</strong></span>
                </p>
                <p> Once the statements are committed, the data change is captured and queued for the client node to push.
                </p>
            </li><li>
                <p> Watch the logging output of both nodes to see the data transfer. The client is configured to push data to
                    the root every minute.</p>
            </li></ol></div>
    </div>
    <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ch02-verify-outgoing"></a>2.8.&nbsp;Verifying Outgoing Batches</h2></div></div></div>
        
        <p>Now that we have pushed and pulled data, we will demonstrate how you can obtain information about what data has been batched and sent.
         A batch is used for tracking and sending data changes to nodes. The sending node creates a batch and the receiving
            node acknowledges it. A batch in error is retried during synchronization attempts, but only after data changes in
            other channels are allowed to be sent. Channels are categories assigned to tables for the purpose of independent
            synchronization and control. Batches for a channel are not created when a batch in the channel is in error status.
        </p>
        <div class="procedure"><ol type="1"><li>
                <p>Open an interactive SQL session with either the root or client database.</p>
            </li><li>
                <p> Verify that the data change you made was captured:</p>
                <p>
                    <span><strong class="command"> select * from sym_data order by data_id desc;</strong></span>
                </p>
                <p> Each row represents a row of data that was changed. The event_type is "I" for insert, "U" for update", or
                    "D" for delete. For insert and update, the captured data values are listed in row_data. For update and delete,
                    the primary key values are listed in pk_data.</p>
            </li><li>
                <p> Verify that the data change was routed to a node, using the data_id from the previous step:</p>
                <p>
                    <span><strong class="command"> select * from sym_data_event where data_id = ?;</strong></span>
                </p>
                <p> When the batched flag is set, the data change is assigned to a batch using a batch_id that is used to track
                    and synchronize the data. Batches are created and assigned during a push or pull synchronization.</p>
            </li><li>
                <p> Verify that the data change was batched, sent, and acknowledged, using the batch_id from the previous step:
                </p>
                <p>
                    <span><strong class="command"> select * from sym_outgoing_batch where batch_id = ?;</strong></span>
                </p>
                <p> A batch represents a collection of changes to be sent to a node. The batch is created during a push or pull
                    synchronization, when the status is set to "NE" for new. The receiving node acknowledges the batch with a
                    status of "OK" for success or "ER" for error.</p>
            </li></ol></div>
        <p>
        Understanding these three tables, along with a fourth table discussed in the next section, is key to diagnosing any synchronizaiton issues you might encounter.
        As you work with SymmetricDS, either when experimenting or starting to use SymmetricDS on your own data, spend time monitoring these tables to
        better understand how SymmetricDS works.
        </p>
    </div>
    <div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="ch02-verify-incoming"></a>2.9.&nbsp;Verifying Incoming Batches</h2></div></div></div>
        
        <p> The receiving node keeps track of the batches it acknowledges and records statistics about loading the data.
            Duplicate batches are skipped by default, but this behavior can be changed with the <code class="literal">incoming.batches.skip.duplicates</code>
            runtime property.</p>
        <div class="procedure"><ol type="1"><li>
                <p>Open an interactive SQL session with either the root or client database.</p>
            </li><li>
                <p> Verify that the batch was acknowledged, using a batch_id from the previous section:</p>
                <p>
                    <span><strong class="command"> select * from sym_incoming_batch where batch_id = ?;</strong></span>
                </p>
                <p> A batch represents a collection of changes loaded by the node. The sending node that created the batch is
                    recorded. The status is either "OK" for success or "ER" for error.</p>
            </li></ol></div>
    </div>
</div><div xmlns:fo="http://www.w3.org/1999/XSL/Format" class="navfooter"><hr><table width="100%" summary="Navigation footer"><tr><td width="30%" align="left"><a accesskey="p" href="introduction.html">Prev</a>&nbsp;</td><td width="40%" align="center"><a accesskey="h" href="user-guide.html">Home</a></td><td width="30%" align="right">&nbsp;<a accesskey="n" href="planning.html">Next</a></td></tr><tr><td width="30%" align="left" valign="top">Chapter&nbsp;1.&nbsp;Introduction&nbsp;</td><td width="40%" align="center"><span style="color:white;font-size:90%;"><a href="http://www.symmetricds.org/" title="SymmetricDS">SymmetricDS
                                        </a></span></td><td width="30%" align="right" valign="top">&nbsp;Chapter&nbsp;3.&nbsp;Planning an Implementation</td></tr></table></div></body></html>